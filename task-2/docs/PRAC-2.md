# Практическое задание №2

## 1. Функциональные требования

### 1.1 Управление пользователями и роли

- Регистрация и вход по телефону или e-mail.
- Поддержка ролей:
  - Клиент (пациент)
  - Врач
  - Администратор отдельной клиники
  - Владелец франшизы
  - Супер-администратор
- Профиль пользователя:
  - Выбор способа нотификации (e-mail / телефон)
  - Выбор языка интерфейса (русский, арабский, китайский)

### 1.2 Запись на прием

- Поиск специалиста по клинике, услуге, специализации.
- Просмотр и выбор свободного слота.
- Возможность отмены и переноса записи.

### 1.3 Онлайн-оплата

- Оплата по ссылке.
- Оплата через СБП.

### 1.4 Медицинская карта

- Хранение истории посещений.
- Хранение диагнозов, протоколов консультаций и заключений.
- Возможность врачу добавить отчет о посещении.
- Возможность пациенту скачать документы.
- Запись на прием автоматически создаёт запись в медицинской карте.

### 1.5 Уведомления

### 1.6 Аналитика и ИИ-ассистент

## 2. Нефункциональные требования

### 2.1 Производительность

- Система должна поддерживать:
  - не менее 150 000 посещений в год
  - не менее 100 000 зарегистрированных пользователей
  - не менее 1000 одновременных активных пользователей
- Массовая отправка уведомлений (до 10 000 сообщений) должна выполняться не более чем за 5 минут.
- Время отклика (95-й перцентиль):
  - поиск врача и свободного слота — < 2 секунд;
  - создание записи на прием — < 2 секунд
  - загрузка медицинской карты пациента — < 3 секунд;
  - загрузка управленческого дашборда — < 5 секунд.
- В экстремальных условиях (пиковая нагрузка x2 от расчетной) деградация производительности не должна превышать 30%, при сохранении доступности сервиса  записи и просмотра медицинских карт

### 2.2 Масштабируемость

- Архитектура должна поддерживать горизонтальное масштабирование (добавление серверов/инстансов).
- Возможность расширения на новые клиники и пользователей без существенного изменения архитектуры.
- Архитектура должна поддерживать ежегодный рост числа пользователей не менее чем на 20% без переработки архитектурных решений.

### 2.3 Надежность

- Доступность системы (SLA) — не менее 99,5% в месяц.
- Среднее время восстановления после сбоя (RTO) — не более 4 часов.
- Система должна обеспечивать:
  - ежедневное автоматическое резервное копирование
  - хранение резервных копий не менее 30 дней
  - регулярное тестирование восстановления не реже 1 раза в квартал
- Критические компоненты (БД, сервер приложений) должны иметь отказоустойчивую конфигурацию.

### 2.4 Безопасность

- Система должна соответствовать:
  - ФЗ-152 «О персональных данных»
  - 54-ФЗ (онлайн-кассы)
  - требованиям к защите медицинской тайны
  - PCI DSS (при оплате банковскими картами)
- RBAC с изоляцией данных по клиникам/франшизам.
- Медицинские данные о пациентах хранятся 1 год
- Данные должны быть: зашифрованы при передаче (TLS 1.2+) и при хранении (не ниже AES-256).
- Для администраторов и владельцев должна быть реализована двухфакторная аутентификация

### 2.5 Сопровождаемость

- Обновление системы должно выполняться без полного остановки сервиса (rolling update).
- Документация API должна быть актуальной и доступна в формате OpenAPI/Swagger.
- Покрытие бизнес-логики автоматическими тестами не менее 70%.
- Время устранения критической ошибки не более 1 рабочего дня.
- Мониторинг производительности, логирования, пайплайнов и бизнес-триггеров, оповещения при превышении порогов.

### 2.6 Модифицируемость

- Интеграция с внешними системами (1С, платёжные системы, SMS-шлюзы, AI-ассистент) должна осуществляться через стандартизированный API
- Добавление новой интеграции не должно требовать изменения существующих модулей системы.
- Поддержка новых языков (включая китайский и арабский) должна обеспечиваться через механизм локализации без изменения бизнес-логики.
- Должна быть возможность добавлять новые функции (новые услуги, новые роли, новые модули) без существенного изменения архитектуры.

### 2.7 Удобство использования

- Пользователь должен иметь возможность выбора канала уведомления (SMS или e-mail) в настройках профиля.
- Интерфейс должен быть адаптивным для: веб-версии и мобильных устройств (iOS/Android).
- Процесс записи пациента должен занимать не более 5 шагов.
- Данные в управленческих дашбордах должны обновляться не реже одного раза в 15 минут.
- Сформировать годовой агрегированный отчёт (динамически) — время генерации < 30 s при предсказуемой нагрузке.

## 3. Архитектурные свойства

### 3.1 Критичные

#### 1. Масштабируемость

**Обоснование:** Поддержка роста с текущих десятков тысяч до 300 000 посещений в год, открытие новых клиник (включая зарубежные) и требование горизонтального масштабирования.

**Альтернативы:**

- Монолит: проще разработка старт, но  сложнее масштабировать по компонентам, поддерживать рост до 300k посещений.
- Чистые микросервисы: Высокая гибкость, но избыточная сложность на этапе старта.

**Компромисс:** модульный монолит с заранее определёнными границами, позволяющий постепенно выносить тяжёлые компоненты в отдельные сервисы при необходимости.

**Риски игнорирования:**

- Отказ сервиса при росте нагрузки, не выполнение основного бизнес-требования.
- Потеря пациентов и выручки.
- Рост технического долга.

---

#### 2. Безопасность и соответствие законодательству

**Обоснование:** Обработка мед. данных и платежей требует соответствия требованиям законодательства о персональных данных, медицинской тайне и стандартам безопасности платежей (например, PCI DSS), иначе риск юридических санкций и утечки данных.

**Альтернативы**:

- Базовый набор мер (TLS, простое RBAC, логирование) — минимальные затраты на внедрение, однако уровень защиты недостаточен для медицинских систем.
- Стандартный комплаенс (TLS1.3, AES-256, KMS, 2FA для админов, аудит) — сбалансированное решение, обеспечивающее соответствие требованиям законодательства при разумных затратах.
- Комплаенс-first (HSM, DLP, SIEM, регулярные pentest, локальное хранение данных) — сбалансированное решение, обеспечивающее соответствие требованиям законодательства при разумных затратах.

**Компромисс:** Реализовать модель «стандартный комплаенс» как базовую архитектуру с возможностью последующего усиления (подключение HSM, внедрение SIEM, расширенный мониторинг и DLP) по мере роста проекта.

**Риски игнорирования:**

- Финансовые штрафы, административная и уголовная ответственность;
- Приостановка деятельности или отзыв лицензии по предписанию регулятора;
- Утечка медицинских карт и платежных данных;
- Потеря доверия пациентов и партнёров;

---

#### 3. Целостность данных

**Обоснование:**
Медицинская карта пациента, статусы записей и платежей  являются юридически значимыми данными. Нарушение целостности может привести к медицинским ошибкам, финансовым потерям и судебным рискам. Кроме того важно избежать двойных записей на один слот, потерей записей и других проблем с расписанием.

**Альтернативы:**

- Строгая транзакционная модель (ACID, реляционная БД + транзакции): гарантии консистентности при операциях записи/обновления, простая модель для аудита.
- Event-sourcing / append-only лог: все изменения хранятся как события; удобна история/версионирование, упрощает восстановление состояния, но повышает сложность реализации
- Eventual consistency: масштабируется на чтение, хороша для высокой нагрузки, но требует сложного механизма разрешения конфликтов

**Компромисс:**
Использовать гибридную модель:

- ACID и транзакционность для критичных данных (EMR, запись, платежи);

- Event-driven для аналитики, уведомлений и вторичных процессов;

Обязательны аудит, версионирование и управляемые миграции БД.

**Риски игнорирования:**

- Потеря или искажение медицинских данных

- Дублирование или потерянные записи на приём

- Расхождение платёжных данных с бухгалтерией

- Судебные риски и потеря доверия пациентов

---

#### 4. Сопровождаемость

**Обосноваине:** система должна легко поддерживаться, обновляться и мониториться. Быстрое обнаружение и устранение проблем критично для стабильной работы клиник и минимизации простоев. Кроме того, это одно из основных требований заказчика

**Альтернативы:**

- Базовое логирование и мониторинг — дешево, но ограничено в диагностике.
- Полный стек наблюдаемости (метрики, логи, трейсинг, alerting) — дороже, но позволяет быстро находить и исправлять сбои, но требует ресурсов и DevOps практик.
- Автоматизированные CI/CD пайплайны с тестами — ускоряют выпуск обновлений, снижают ошибки, требуют инвестиций в инфраструктуру.

**Компромисс:**
Начать с базового наблюдения + алертов для критичных сервисов и CI/CD с автоматическими тестами.

**Риски игнорирования:**

- Длительное время восстановления при сбоях;
- Рост операционных затрат из-за ручной диагностики;
- Риск ошибок при обновлениях и миграциях;
- Невозможность быстро масштабировать или интегрировать новые модули без простоя;

## 3.2 Второстепенные

- Модифицируемость
- Аналитичность / AI-ассистент
- Удобство использования (UX)
